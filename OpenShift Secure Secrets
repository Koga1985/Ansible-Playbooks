- name: Secure OpenShift Secrets
  hosts: localhost
  gather_facts: no
  vars:
    secret_name: "secure-secret"
    secret_key: "password"
    secret_value: "{{ lookup('env', 'SECRET_VALUE') }}"  # Load from environment variable
  tasks:
    - name: Create a Secret
      command: oc create secret generic {{ secret_name }} --from-literal={{ secret_key }}={{ secret_value }}
      register: secret_result
      failed_when: "'created' not in secret_result.stdout and 'already exists' not in secret_result.stdout"

    - name: Restrict access to the secret
      command: oc annotate secret {{ secret_name }} kubernetes.io/service-account.name=restricted-user
      register: annotation_result
      failed_when: "'annotated' not in annotation_result.stdout and 'already' not in annotation_result.stdout"

    - name: Confirm Secret Creation
      debug:
        msg: "Secret '{{ secret_name }}' created and access restricted."
