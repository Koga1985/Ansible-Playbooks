---
- name: Deploy Claroty CTD Server
  hosts: claroty_servers
  become: yes
  tasks:
    - name: Install required dependencies
      apt:
        name:
          - docker.io
          - curl
        state: present
        update_cache: yes

    - name: Download Claroty CTD Installer
      get_url:
        url: "https://claroty.com/downloads/ctd_installer.sh"
        dest: "/tmp/ctd_installer.sh"
        mode: "0755"

    - name: Run Claroty CTD Installer
      command: "/bin/bash /tmp/ctd_installer.sh"
      args:
        creates: "/opt/claroty/ctd"
