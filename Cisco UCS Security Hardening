- name: Secure UCSM
  hosts: localhost
  gather_facts: no
  vars:
    ucs_hostname: "ucs-manager.example.com"
    ucs_username: "admin"
    ucs_password: "{{ lookup('ansible.builtin.env', 'UCS_PASSWORD') }}"  # Fetch from environment variable

  tasks:
    - name: Set UCSM connection details
      ansible.builtin.set_fact:
        ucs_auth:
          hostname: "{{ ucs_hostname }}"
          username: "{{ ucs_username }}"
          password: "{{ ucs_password }}"
      no_log: true  # Hides sensitive data

    - name: Disable SSH and Telnet access
      cisco.ucs.ucs_security:
        hostname: "{{ ucs_auth.hostname }}"
        username: "{{ ucs_auth.username }}"
        password: "{{ ucs_auth.password }}"
        ssh: disabled
        telnet: disabled
        state: present
      delegate_to: localhost
      no_log: true  # Hides sensitive logs

    - name: Enforce strong password policy
      cisco.ucs.ucs_password_policy:
        hostname: "{{ ucs_auth.hostname }}"
        username: "{{ ucs_auth.username }}"
        password: "{{ ucs_auth.password }}"
        min_length: 12
        complexity: high
        expiration_days: 90
        state: present
      delegate_to: localhost
      no_log: true  # Hides sensitive logs
